<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Перевірка Telegram Login Widget</title>
    <script async src="https://telegram.org/js/telegram-widget.js?22"
            data-telegram-login="NameNestBot" 
            data-size="large" 
            data-radius="10" 
            data-request-access="write"
            data-auth-url="https://example.com"
            data-onauth="onTelegramAuth(user)"></script>
</head>
<body>
    <h1>Авторизація через Telegram</h1>
    <p>Якщо ви авторизуєтесь через Telegram, буде відображено ваш user_id.</p>

    <div id="result">Очікуємо авторизації...</div>

    <script>
        function onTelegramAuth(user) {
            const resultDiv = document.getElementById('result');
            const user_id = user.id;

            resultDiv.innerText = `Ваш user_id: ${user_id}`;

            // Виконати POST-запит
            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://ws.zolotiyvik.ua:8443/Buffer/hs/Incoming/test/');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    resultDiv.innerText += `\nВідповідь: ${xhr.responseText}`;
                } else {
                    resultDiv.innerText += `\nПомилка: ${xhr.status}`;
                }
            };
            xhr.onerror = function () {
                resultDiv.innerText += '\nПомилка запиту.';
            };
            xhr.send(`user_id=${encodeURIComponent(user_id)}`);
        }
    </script>
</body>
</html>
