<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Тест авторизації через Telegram</title>
    <script src="https://telegram.org/js/telegram-widget.js?7"
            data-telegram-login="@NameNestBot"
            data-size="large"
            data-radius="10"
            data-request-access="write"></script>
</head>
<body>
<h1>Перевірка доступу через Telegram WebApp</h1>
<button id="checkAccess">Перевірити доступ</button>
<div id="result"></div>

<script>
    document.getElementById('checkAccess').addEventListener('click', function () {
        if (typeof Telegram === 'undefined' || !Telegram.WebApp.initDataUnsafe) {
            document.getElementById('result').innerText = 'Telegram WebApp не ініціалізований.';
            return;
        }

        const user_id = Telegram.WebApp.initDataUnsafe.user?.id;
        if (!user_id) {
            document.getElementById('result').innerText = 'Не вдалося отримати user_id.';
            return;
        }

        document.getElementById('result').innerText = `Отримано user_id: ${user_id}. Виконується перевірка...`;

        // Виконуємо AJAX-запит
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://ws.zolotiyvik.ua:8443/Buffer/hs/Incoming/test/'); // URL для перевірки
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function () {
            if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (response.status === 'true') {
                    document.getElementById('result').innerText += `\nДоступ дозволено.`;
                } else {
                    document.getElementById('result').innerText += `\nДоступ заборонено.`;
                }
            } else {
                document.getElementById('result').innerText += `\nСталася помилка. Код статусу: ${xhr.status}`;
            }
        };
        xhr.onerror = function () {
            document.getElementById('result').innerText += '\nПомилка запиту.';
        };
        xhr.send(`user_id=${encodeURIComponent(user_id)}`);
    });
</script>
</body>
</html>
