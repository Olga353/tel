<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Тест авторизації через Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        #content { display: none; }
    </style>
</head>
<body>
<div id="content">
    <h1>Вітаємо! Ви маєте доступ.</h1>
    <p>Цей контент бачать тільки дозволені користувачі.</p>
</div>

<div id="no-access" style="display: none;">
    <h1>Доступ заборонено</h1>
    <p>Вибачте, але у вас немає доступу до цієї сторінки.</p>
</div>

<script>
    window.onload = function () {
        if (typeof Telegram === 'undefined' || !Telegram.WebApp.initDataUnsafe) {
            document.body.innerHTML = '<h1>Telegram WebApp не ініціалізований.</h1>';
            return;
        }

        const user_id = Telegram.WebApp.initDataUnsafe.user?.id;
        if (!user_id) {
            document.body.innerHTML = '<h1>Не вдалося отримати user_id.</h1>';
            return;
        }

        // Виконуємо AJAX-запит
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://ws.zolotiyvik.ua:8443/Buffer/hs/Incoming/test/');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function () {
            if (xhr.status === 200) {
                let response = xhr.responseText.trim().toLowerCase();

                // Перевіряємо відповідь
                if (response === 'true') {
                    document.getElementById('content').style.display = 'block';
                } else {
                    document.getElementById('no-access').style.display = 'block';
                }
            } else {
                document.body.innerHTML = `<h1>Помилка сервера. Код: ${xhr.status}</h1>`;
            }
        };
        xhr.onerror = function () {
            document.body.innerHTML = '<h1>Помилка запиту.</h1>';
        };

        xhr.send(`user_id=${encodeURIComponent(user_id)}`);
    };
</script>
</body>
</html>
